(function(e){function t(t){for(var a,o,s=t[0],c=t[1],l=t[2],u=0,f=[];u<s.length;u++)o=s[u],r[o]&&f.push(r[o][0]),r[o]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);p&&p(t);while(f.length)f.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],a=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(a=!1)}a&&(i.splice(t--,1),e=o(o.s=n[0]))}return e}var a={},r={app:0},i=[];function o(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=a,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(n,a,function(t){return e[t]}.bind(null,a));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var p=c;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"034f":function(e,t,n){"use strict";var a=n("1356"),r=n.n(a);r.a},1356:function(e,t,n){},9224:function(e){e.exports={a:"1.0.0"}},cd49:function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var a=n("2b0e"),r=n("bb71");n("da64");a["a"].use(r["a"],{});var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-app",{staticStyle:{height:"100%"}},[a("vue-topprogress",{ref:"topProgress",attrs:{color:"#f96d00",trickle:!1}}),a("v-toolbar",{attrs:{app:"",dark:"",color:"#222831"}},[a("v-toolbar-title",{staticClass:"headline text-uppercase"},[a("a",{staticStyle:{"text-decoration":"none"},attrs:{href:"http://www.cemfi.de/",target:"_blank"}},[a("span",{staticStyle:{color:"#f96d00"}},[e._v("CEMFI.")])]),a("span",{staticClass:"font-weight-thin"},[e._v("Deep Optical Measure Detector")])]),a("v-spacer"),e._v("\n    v"+e._s(e.version)+"\n  ")],1),a("v-content",[a("v-container",{staticStyle:{height:"100%",display:"grid"},on:{drop:function(t){return t.preventDefault(),e.onFileDrop(t)},dragover:function(e){e.preventDefault()}}},[0==e.images.length?a("div",{staticClass:"display-1",staticStyle:{margin:"auto",color:"#222831"}},[e._v("Drop image files here")]):a("v-card",[a("v-list",{attrs:{dense:""}},e._l(e.images,function(t,r){return a("v-list-tile",{key:r,attrs:{avatar:""}},[a("v-list-tile-avatar",[t.isFinished?a("img",{staticStyle:{width:"22px",height:"22px"},attrs:{src:n("fd49")}}):a("v-progress-circular",{attrs:{indeterminate:"",color:"#f96d00"}})],1),a("div",{staticClass:"ellipsize-left"},[e._v(e._s(t.file.name))])],1)}),1)],1)],1)],1)],1)},o=[],s=(n("a481"),n("7f7f"),n("7514"),n("55dd"),n("5df3"),n("1c4c"),n("ac6a"),n("a36f")),c=n("bc3a"),l=n.n(c),p=n("21a6"),u=n.n(p),f=n("1157"),d=n.n(f),h=n("5a6d"),m=n("347e"),g=n.n(m),v=n("9224");function b(e){var t=1;return"-"===e[0]&&(t=-1,e=e.substr(1)),function(n,a){var r=n[e]<a[e]?-1:n[e]>a[e]?1:0;return r*t}}function y(e,t){return'<?xml version="1.0" encoding="UTF-8"?>\n    <mei xmlns="http://www.music-encoding.org/ns/mei">\n        <meiHead>\n            <fileDesc>\n                <titleStmt/>\n                <pubStmt/>\n            </fileDesc>\n            <encodingDesc>\n                <appInfo>\n                    <application isodate="'.concat(e,'" version="').concat(t,'">\n                        <name>Deep Optical Measure Recognition</name>\n                        <p>Measures detected with Deep Optical Measure Recognition</p>\n                    </application>\n                </appInfo>\n            </encodingDesc>\n        </meiHead>\n        <music>\n            <facsimile>\n            </facsimile>\n            <body>\n              <mdiv xml:id="mdiv_').concat(Object(h["a"])(),'" n="1" label="">\n                <score>\n                  <scoreDef/>\n                  <section>\n                    <pb/>\n                  </section>\n                </score>\n              </mdiv>\n            </body>\n        </music>\n    </mei>')}var w={dynamicSort:b,getTemplate:y},x={name:"App",components:{vueTopprogress:s["vueTopprogress"]},data:function(){return{version:v["a"],images:[],currentImage:null,countFinished:0}},methods:{onFileDrop:function(e){var t=this;if(0===this.images.length){var n=[];Array.from(e.dataTransfer.files).forEach(function(e){n.push(e)}),n.sort(w.dynamicSort("name")),n.forEach(function(e){t.images.push({file:e,isFinished:!1})}),this.$refs.topProgress.start(),this.processNext()}},processNext:function(){var e=this,t=this.images.find(function(e){return!e.isFinished});if(void 0!==t){var n=new FileReader;n.onload=function(e){var a=new Image;a.src=n.result,a.onload=function(){t.width=a.width,t.height=a.height}},n.readAsDataURL(t.file);var a=new FormData;a.append("image",t.file),l.a.post("http://localhost:8080/upload",a,{headers:{"Access-Control-Allow-Origin":"*","Content-Type":"multipart/form-data"}}).then(function(n){t.measures=n.data.measures,t.isFinished=!0,e.countFinished+=1,e.$refs.topProgress.progress=e.countFinished/e.images.length*100,e.processNext()}).catch(function(t){e.$refs.topProgress.fail(),console.log(t)})}else this.generateMei()},generateMei:function(){var e=w.getTemplate((new Date).toISOString(),this.version),t=d()(d.a.parseXML(e)),n=t.find("facsimile").first(),a=t.find("section").first(),r=1;this.images.forEach(function(e,t){n.append('<surface xml:id="surface_'.concat(Object(h["a"])(),'"\n            n="').concat(t+1,'"\n            ulx="0"\n            uly="0"\n            lrx="').concat(e.width-1,'"\n            lry="').concat(e.height-1,'"\n          />'));var i=n.find("surface").last();i.append('<graphic xml:id="graphic_'.concat(Object(h["a"])(),'"\n            target="').concat(e.file.name,'"\n            width="').concat(e.width,'"\n            height="').concat(e.height,'"\n          />')),e.measures.forEach(function(t,n){var o="zone_".concat(Object(h["a"])());i.append('<zone xml:id="'.concat(o,'"\n              type="measure"\n              ulx="').concat(Math.floor(t.left),'"\n              uly="').concat(Math.floor(t.top),'"\n              lrx="').concat(Math.floor(t.right),'"\n              lry="').concat(Math.floor(t.bottom),'"\n            />')),a.append('<measure xml:id="measure_'.concat(Object(h["a"])(),'"\n              n="').concat(r,'"\n              label="').concat(r,'"\n              facs="#').concat(o,'"\n            />')),r+=1,e.measures.length>n+1&&e.measures[n+1].left<t.left?a.append("<sb />"):e.measures.length<=n+1&&a.append("<sb />")}),a.append("<pb />")});var i=(new XMLSerializer).serializeToString(t.get(0));i=g.a.xml(i.replace(/ xmlns=""/g,"")),u()(new Blob([i],{type:"text/plain;charset=utf-8"}),"measure_annotations.mei")}}},_=x,O=(n("034f"),n("2877")),S=n("6544"),D=n.n(S),M=n("7496"),T=n("b0af"),j=n("a523"),F=n("549c"),C=n("8860"),P=n("ba95"),V=n("c954"),k=n("490a"),A=n("9910"),E=n("71d9"),I=n("2a7f"),L=Object(O["a"])(_,i,o,!1,null,null,null),z=L.exports;D()(L,{VApp:M["a"],VCard:T["a"],VContainer:j["a"],VContent:F["a"],VList:C["a"],VListTile:P["a"],VListTileAvatar:V["a"],VProgressCircular:k["a"],VSpacer:A["a"],VToolbar:E["a"],VToolbarTitle:I["a"]}),a["a"].config.productionTip=!1,new a["a"]({render:function(e){return e(z)}}).$mount("#app")},fd49:function(e,t,n){e.exports=n.p+"img/check-solid.a2b583ea.svg"}});