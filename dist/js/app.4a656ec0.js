(function(e){function t(t){for(var a,s,o=t[0],c=t[1],l=t[2],p=0,f=[];p<o.length;p++)s=o[p],i[s]&&f.push(i[s][0]),i[s]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);u&&u(t);while(f.length)f.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],a=!0,o=1;o<n.length;o++){var c=n[o];0!==i[c]&&(a=!1)}a&&(r.splice(t--,1),e=s(s.s=n[0]))}return e}var a={},i={app:0},r=[];function s(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=a,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(n,a,function(t){return e[t]}.bind(null,a));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var u=c;r.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"034f":function(e,t,n){"use strict";var a=n("1356"),i=n.n(a);i.a},1356:function(e,t,n){},9224:function(e){e.exports={a:"1.1.0"}},cc2a:function(e,t,n){e.exports=n.p+"img/cog.a4f81f19.svg"},ccb8:function(e,t,n){e.exports=n.p+"img/times.ce2dbb30.svg"},cd49:function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var a=n("2b0e"),i=n("bb71");n("da64");a["a"].use(i["a"],{});var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-app",{staticStyle:{height:"100%"}},[a("vue-topprogress",{ref:"topProgress",attrs:{color:"#f96d00",trickle:!1}}),a("v-toolbar",{attrs:{app:"",dark:"",color:"#222831"}},[a("v-toolbar-title",{staticClass:"headline text-uppercase"},[a("a",{staticStyle:{"text-decoration":"none"},attrs:{href:"http://www.cemfi.de/",target:"_blank"}},[a("span",{staticStyle:{color:"#f96d00"}},[e._v("CEMFI.")])]),a("span",{staticClass:"font-weight-thin"},[e._v("Deep Optical Measure Detector")])]),a("v-spacer"),e._v("\n    v"+e._s(e.version)+"\n  ")],1),a("v-content",[a("v-container",{staticStyle:{height:"100%"},on:{drop:function(t){return t.preventDefault(),e.onFileDrop(t)},dragover:function(e){e.preventDefault()}}},[a("v-card",{staticStyle:{height:"100%"}},[0==e.images.length?a("div",{staticClass:"dropZone"},[a("span",{staticClass:"display-1"},[e._v("Drop image files here")]),a("p",{staticStyle:{"margin-top":"20px"}},[e._v("(All files will be sorted alphanumerically before processing.)")])]):a("v-list",{attrs:{dense:""}},e._l(e.images,function(t,i){return a("v-list-tile",{key:i,attrs:{avatar:""},on:{click:function(t){return t.stopPropagation(),e.showImage(i)}}},[a("v-list-tile-avatar",["error"===t.status?a("img",{staticStyle:{width:"32px",height:"32px"},attrs:{src:n("ccb8")}}):"success"===t.status?a("img",{staticStyle:{width:"32px",height:"32px"},attrs:{src:n("f222")}}):"enqueued"===t.status?a("img",{staticStyle:{width:"32px",height:"32px"},attrs:{src:n("e0f8")}}):"processing"===t.status?a("img",{staticStyle:{width:"32px",height:"32px",animation:"rotation 2s infinite linear"},attrs:{src:n("cc2a")}}):e._e()]),a("div",{staticClass:"ellipsize-left"},[e._v(e._s(t.file.name))])],1)}),1)],1)],1),a("v-dialog",{attrs:{"max-width":"1000"},model:{value:e.showViewer,callback:function(t){e.showViewer=t},expression:"showViewer"}},[a("v-card",{staticClass:"pa-3",attrs:{dark:"",color:"#222831"}},[a("canvas",{ref:"canvas",staticStyle:{"max-width":"100%"},on:{click:function(t){e.showViewer=!1}}}),a("span",{staticClass:"ellipsize-left",staticStyle:{"font-size":"13px"}},[e._v(e._s(e.viewerFilename))])])],1)],1)],1)},s=[],o=(n("a481"),n("7514"),n("6c7b"),n("7f7f"),n("55dd"),n("5df3"),n("1c4c"),n("ac6a"),n("a36f")),c=n("bc3a"),l=n.n(c),u=n("21a6"),p=n.n(u),f=n("1157"),d=n.n(f),h=n("5a6d"),g=n("347e"),m=n.n(g),v=n("9224");function w(e){var t=1;return"-"===e[0]&&(t=-1,e=e.substr(1)),function(n,a){var i=n[e]<a[e]?-1:n[e]>a[e]?1:0;return i*t}}function b(e,t){return'<?xml version="1.0" encoding="UTF-8"?>\n    <mei xmlns="http://www.music-encoding.org/ns/mei">\n        <meiHead>\n            <fileDesc>\n                <titleStmt/>\n                <pubStmt/>\n            </fileDesc>\n            <encodingDesc>\n                <appInfo>\n                    <application isodate="'.concat(e,'" version="').concat(t,'">\n                        <name>Deep Optical Measure Recognition</name>\n                        <p>Measures detected with Deep Optical Measure Recognition</p>\n                    </application>\n                </appInfo>\n            </encodingDesc>\n        </meiHead>\n        <music>\n            <facsimile>\n            </facsimile>\n            <body>\n              <mdiv xml:id="mdiv_').concat(Object(h["a"])(),'" n="1" label="">\n                <score>\n                  <scoreDef/>\n                  <section>\n                    <pb/>\n                  </section>\n                </score>\n              </mdiv>\n            </body>\n        </music>\n    </mei>')}var x={dynamicSort:w,getTemplate:b},y={name:"App",components:{vueTopprogress:o["vueTopprogress"]},data:function(){return{version:v["a"],images:[],countFinished:0,showViewer:!1,viewerFilename:null}},methods:{onFileDrop:function(e){var t=this;this.images=[],this.countFinished=0;var n=[];Array.from(e.dataTransfer.files).forEach(function(e){n.push(e)}),n.sort(x.dynamicSort("name")),n.forEach(function(e){t.images.push({file:e,status:"enqueued"})}),this.$refs.topProgress.start(),this.processNext()},showImage:function(e){var t=this,n=this.images[e],a=new FileReader;this.viewerFilename=n.file.name,this.$refs.canvas.width=0,this.$refs.canvas.height=0,a.onload=function(e){var i=new Image;i.src=a.result,i.onload=function(){t.$refs.canvas.width=i.width,t.$refs.canvas.height=i.height;var e=t.$refs.canvas.getContext("2d");e.drawImage(i,0,0),void 0!==n.measures&&(e.lineWidth="3",e.strokeStyle="#f96d00",e.fillStyle="#22283144",n.measures.forEach(function(t){e.beginPath(),e.rect(t.ulx,t.uly,t.lrx-t.ulx,t.lry-t.uly),e.fill()}),n.measures.forEach(function(t){e.beginPath(),e.rect(t.ulx,t.uly,t.lrx-t.ulx,t.lry-t.uly),e.stroke()}))},t.showViewer=!0},a.readAsDataURL(n.file)},processNext:function(){var e=this,t=this.images.find(function(e){return"enqueued"===e.status});if(void 0!==t){t.status="processing";var n=new FileReader;n.onload=function(e){var a=new Image;a.src=n.result,a.onload=function(){t.width=a.width,t.height=a.height}},n.readAsDataURL(t.file);var a=new FormData;a.append("image",t.file),l.a.post("http://localhost:8080/upload",a,{headers:{"Access-Control-Allow-Origin":"*","Content-Type":"multipart/form-data"}}).then(function(n){t.measures=n.data.measures,t.status="success",e.countFinished+=1,e.$refs.topProgress.progress=e.countFinished/e.images.length*100,e.processNext()}).catch(function(n){t.status="error",e.countFinished+=1,e.$refs.topProgress.progress=e.countFinished/e.images.length*100,console.log(n),e.processNext()})}else this.generateMei()},generateMei:function(){var e=x.getTemplate((new Date).toISOString(),this.version),t=d()(d.a.parseXML(e)),n=t.find("facsimile").first(),a=t.find("section").first(),i=1,r=1;this.images.forEach(function(e){if("success"===e.status){n.append('<surface xml:id="surface_'.concat(Object(h["a"])(),'"\n            n="').concat(r,'"\n            ulx="0"\n            uly="0"\n            lrx="').concat(e.width-1,'"\n            lry="').concat(e.height-1,'"\n          />'));var t=n.find("surface").last();t.append('<graphic xml:id="graphic_'.concat(Object(h["a"])(),'"\n            target="').concat(e.file.name,'"\n            width="').concat(e.width,'"\n            height="').concat(e.height,'"\n          />')),e.measures.forEach(function(n,r){var s="zone_".concat(Object(h["a"])());t.append('<zone xml:id="'.concat(s,'"\n              type="measure"\n              ulx="').concat(Math.floor(n.ulx),'"\n              uly="').concat(Math.floor(n.uly),'"\n              lrx="').concat(Math.floor(n.lrx),'"\n              lry="').concat(Math.floor(n.lry),'"\n            />')),a.append('<measure xml:id="measure_'.concat(Object(h["a"])(),'"\n              n="').concat(i,'"\n              label="').concat(i,'"\n              facs="#').concat(s,'"\n            />')),i+=1,e.measures.length>r+1&&e.measures[r+1].ulx<n.ulx?a.append("<sb />"):e.measures.length<=r+1&&a.append("<sb />")}),a.append("<pb />"),r+=1}});var s=(new XMLSerializer).serializeToString(t.get(0));s=m.a.xml(s.replace(/ xmlns=""/g,"")),p()(new Blob([s],{type:"text/plain;charset=utf-8"}),"measure_annotations.mei")}}},S=y,_=(n("034f"),n("2877")),O=n("6544"),D=n.n(O),M=n("7496"),V=n("b0af"),F=n("a523"),T=n("549c"),k=n("169a"),j=n("8860"),C=n("ba95"),P=n("c954"),$=n("9910"),A=n("71d9"),I=n("2a7f"),E=Object(_["a"])(S,r,s,!1,null,null,null),z=E.exports;D()(E,{VApp:M["a"],VCard:V["a"],VContainer:F["a"],VContent:T["a"],VDialog:k["a"],VList:j["a"],VListTile:C["a"],VListTileAvatar:P["a"],VSpacer:$["a"],VToolbar:A["a"],VToolbarTitle:I["a"]}),a["a"].config.productionTip=!1,new a["a"]({render:function(e){return e(z)}}).$mount("#app")},e0f8:function(e,t,n){e.exports=n.p+"img/clock.65798b54.svg"},f222:function(e,t,n){e.exports=n.p+"img/check.a8150abd.svg"}});