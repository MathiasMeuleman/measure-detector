(function(e){function t(t){for(var a,r,o=t[0],c=t[1],l=t[2],p=0,f=[];p<o.length;p++)r=o[p],i[r]&&f.push(i[r][0]),i[r]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);u&&u(t);while(f.length)f.shift()();return s.push.apply(s,l||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],a=!0,o=1;o<n.length;o++){var c=n[o];0!==i[c]&&(a=!1)}a&&(s.splice(t--,1),e=r(r.s=n[0]))}return e}var a={},i={app:0},s=[];function r(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=a,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var u=c;s.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"034f":function(e,t,n){"use strict";var a=n("1356"),i=n.n(a);i.a},1356:function(e,t,n){},9224:function(e){e.exports={a:"1.2.1"}},cd49:function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var a=n("2b0e"),i=n("bb71");n("da64");a["a"].use(i["a"],{});var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",{staticStyle:{height:"100%"}},[n("vue-topprogress",{ref:"topProgress",attrs:{color:"#f96d00",trickle:!1}}),n("v-toolbar",{attrs:{app:"",dark:"",color:"#222831"}},[n("v-toolbar-title",{staticClass:"headline text-uppercase"},[n("a",{staticStyle:{"text-decoration":"none"},attrs:{href:"http://www.cemfi.de/",target:"_blank"}},[n("span",{staticStyle:{color:"#f96d00"}},[e._v("CEMFI.")])]),n("span",{staticClass:"font-weight-thin"},[e._v("Deep Optical Measure Detector")])]),n("v-spacer"),e._v("\n    v"+e._s(e.version)+"\n  ")],1),n("v-content",[n("v-container",{staticStyle:{height:"100%"},on:{drop:function(t){return t.preventDefault(),e.onFileDrop(t)},dragover:function(e){e.preventDefault()}}},[n("v-card",{staticStyle:{height:"100%"}},[0==e.images.length?n("div",{staticClass:"dropZone"},[n("span",{staticClass:"display-1"},[e._v("Drop image files here")]),n("p",{staticStyle:{"margin-top":"20px"}},[e._v("(All files will be sorted alphanumerically before processing.)")])]):n("v-list",{attrs:{dense:""}},e._l(e.images,function(t,a){return n("v-list-tile",{key:a,attrs:{avatar:""},on:{click:function(t){return t.stopPropagation(),e.showImage(a)}}},[n("v-list-tile-avatar",[n("img",{class:{rotate:"processing"===t.status},staticStyle:{width:"32px",height:"32px"},attrs:{src:e.publicPath+"icons/"+t.status+".svg"}})]),n("div",{staticClass:"ellipsize-left"},[e._v(e._s(t.file.name))])],1)}),1)],1)],1),n("v-dialog",{attrs:{"max-width":"1000"},model:{value:e.showViewer,callback:function(t){e.showViewer=t},expression:"showViewer"}},[n("v-card",{staticClass:"pa-3",attrs:{dark:"",color:"#222831"}},[n("canvas",{ref:"canvas",staticStyle:{"max-width":"100%"},on:{click:function(t){e.showViewer=!1}}}),n("span",{staticClass:"ellipsize-left",staticStyle:{"font-size":"13px"}},[e._v(e._s(e.viewerFilename))])])],1)],1)],1)},r=[],o=(n("a481"),n("7514"),n("6c7b"),n("7f7f"),n("55dd"),n("5df3"),n("1c4c"),n("ac6a"),n("a36f")),c=n("bc3a"),l=n.n(c),u=n("21a6"),p=n.n(u),f=n("1157"),h=n.n(f),d=n("5a6d"),g=n("347e"),m=n.n(g),v=n("9224");function w(e){var t=1;return"-"===e[0]&&(t=-1,e=e.substr(1)),function(n,a){var i=n[e]<a[e]?-1:n[e]>a[e]?1:0;return i*t}}function b(e,t){return'<?xml version="1.0" encoding="UTF-8"?>\n    <mei xmlns="http://www.music-encoding.org/ns/mei">\n        <meiHead>\n            <fileDesc>\n                <titleStmt/>\n                <pubStmt/>\n            </fileDesc>\n            <encodingDesc>\n                <appInfo>\n                    <application isodate="'.concat(e,'" version="').concat(t,'">\n                        <name>Deep Optical Measure Recognition</name>\n                        <p>Measures detected with Deep Optical Measure Recognition</p>\n                    </application>\n                </appInfo>\n            </encodingDesc>\n        </meiHead>\n        <music>\n            <facsimile>\n            </facsimile>\n            <body>\n              <mdiv xml:id="mdiv_').concat(Object(d["a"])(),'" n="1" label="">\n                <score>\n                  <scoreDef/>\n                  <section>\n                    <pb/>\n                  </section>\n                </score>\n              </mdiv>\n            </body>\n        </music>\n    </mei>')}var y={dynamicSort:w,getTemplate:b},x={name:"App",components:{vueTopprogress:o["vueTopprogress"]},data:function(){return{publicPath:"",version:v["a"],images:[],countFinished:0,showViewer:!1,viewerFilename:null}},mounted:function(){(new Image).src="".concat(this.publicPath,"icons/enqueued.svg"),(new Image).src="".concat(this.publicPath,"icons/success.svg"),(new Image).src="".concat(this.publicPath,"icons/processing.svg"),(new Image).src="".concat(this.publicPath,"icons/error.svg")},methods:{onFileDrop:function(e){var t=this;this.images=[],this.countFinished=0;var n=[];Array.from(e.dataTransfer.files).forEach(function(e){n.push(e)}),n.sort(y.dynamicSort("name")),n.forEach(function(e){t.images.push({file:e,status:"enqueued"})}),this.$refs.topProgress.start(),this.processNext()},showImage:function(e){var t=this,n=this.images[e],a=new FileReader;this.viewerFilename=n.file.name,this.$refs.canvas.width=0,this.$refs.canvas.height=0,a.onload=function(e){var i=new Image;i.src=a.result,i.onload=function(){t.$refs.canvas.width=i.width,t.$refs.canvas.height=i.height;var e=t.$refs.canvas.getContext("2d");e.drawImage(i,0,0),void 0!==n.measures&&(e.lineWidth="3",e.strokeStyle="#f96d00",e.fillStyle="#22283144",n.measures.forEach(function(t){e.beginPath(),e.rect(t.ulx,t.uly,t.lrx-t.ulx,t.lry-t.uly),e.fill()}),n.measures.forEach(function(t){e.beginPath(),e.rect(t.ulx,t.uly,t.lrx-t.ulx,t.lry-t.uly),e.stroke()}))},t.showViewer=!0},a.readAsDataURL(n.file)},processNext:function(){var e=this,t=this.images.find(function(e){return"enqueued"===e.status});if(void 0!==t){t.status="processing";var n=new FileReader;n.onload=function(e){var a=new Image;a.src=n.result,a.onload=function(){t.width=a.width,t.height=a.height}},n.readAsDataURL(t.file);var a=new FormData;a.append("image",t.file),l.a.post("http://localhost:8080/upload",a,{headers:{"Access-Control-Allow-Origin":"*","Content-Type":"multipart/form-data"}}).then(function(n){t.measures=n.data.measures,t.status="success",e.countFinished+=1,e.$refs.topProgress.progress=e.countFinished/e.images.length*100,e.processNext()}).catch(function(n){t.status="error",e.countFinished+=1,e.$refs.topProgress.progress=e.countFinished/e.images.length*100,console.log(n),e.processNext()})}else this.generateMei()},generateMei:function(){var e=y.getTemplate((new Date).toISOString(),this.version),t=h()(h.a.parseXML(e)),n=t.find("facsimile").first(),a=t.find("section").first(),i=1,s=1;this.images.forEach(function(e){if("success"===e.status){n.append('<surface xml:id="surface_'.concat(Object(d["a"])(),'"\n            n="').concat(s,'"\n            ulx="0"\n            uly="0"\n            lrx="').concat(e.width-1,'"\n            lry="').concat(e.height-1,'"\n          />'));var t=n.find("surface").last();t.append('<graphic xml:id="graphic_'.concat(Object(d["a"])(),'"\n            target="').concat(e.file.name,'"\n            width="').concat(e.width,'"\n            height="').concat(e.height,'"\n          />')),e.measures.forEach(function(n,s){var r="zone_".concat(Object(d["a"])());t.append('<zone xml:id="'.concat(r,'"\n              type="measure"\n              ulx="').concat(Math.floor(n.ulx),'"\n              uly="').concat(Math.floor(n.uly),'"\n              lrx="').concat(Math.floor(n.lrx),'"\n              lry="').concat(Math.floor(n.lry),'"\n            />')),a.append('<measure xml:id="measure_'.concat(Object(d["a"])(),'"\n              n="').concat(i,'"\n              label="').concat(i,'"\n              facs="#').concat(r,'"\n            />')),i+=1,e.measures.length>s+1&&e.measures[s+1].ulx<n.ulx?a.append("<sb />"):e.measures.length<=s+1&&a.append("<sb />")}),a.append("<pb />"),s+=1}});var r=(new XMLSerializer).serializeToString(t.get(0));r=m.a.xml(r.replace(/ xmlns=""/g,"")),p()(new Blob([r],{type:"text/plain;charset=utf-8"}),"measure_annotations.mei")}}},_=x,S=(n("034f"),n("2877")),O=n("6544"),D=n.n(O),P=n("7496"),M=n("b0af"),V=n("a523"),F=n("549c"),T=n("169a"),j=n("8860"),C=n("ba95"),k=n("c954"),I=n("9910"),$=n("71d9"),A=n("2a7f"),E=Object(S["a"])(_,s,r,!1,null,null,null),z=E.exports;D()(E,{VApp:P["a"],VCard:M["a"],VContainer:V["a"],VContent:F["a"],VDialog:T["a"],VList:j["a"],VListTile:C["a"],VListTileAvatar:k["a"],VSpacer:I["a"],VToolbar:$["a"],VToolbarTitle:A["a"]}),a["a"].config.productionTip=!1,new a["a"]({render:function(e){return e(z)}}).$mount("#app")}});